# -*- coding: utf-8 -*-
"""AI English dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1iUFfF-szhgu9B3TpCkt6LlT6z80ynhC-
"""

!pip install datasets

from datasets import load_dataset

# Load TinyStories (the small version)
dataset = load_dataset("roneneldan/TinyStories")

# Show an example
print(dataset["train"][0])

# Checking the paragraphs
for i in range(5):
    print("text", i+1)
    print(dataset["train"][i]["text"])
    print("-----------")

# Extract all texts from train split
texts = [item["text"] for item in dataset["train"]]

"""Keep the paragraphs between 300-350 words and ends with a full sentence"""

import re

# Split text into clean sentences
def split_sentences(text):
    # Basic sentence split using punctuation
    sentences = re.split(r'(?<=[.!?])\s+', text.strip())
    # Remove empty sentences
    return [s.strip() for s in sentences if len(s.strip()) > 0]

# Build paragraph of 300–360 words ending with complete sentence
def build_paragraph(start_index, min_words=300, max_words=350):
    sentences = []
    idx = start_index
    word_count = 0

    # PHASE 1 -> reach minimum words (may overshoot, but we'll fix)
    while word_count < min_words:
        story_sentences = split_sentences(texts[idx])
        sentences.extend(story_sentences)
        word_count = len(" ".join(sentences).split())
        idx += 1

        if idx >= len(texts):
            break

    # PHASE 2 -> cap at max_words, add sentence-by-sentence only
    final_sentences = []
    current_words = 0

    for sent in sentences:
        sent_words = len(sent.split())

        # If adding this sentence exceeds 360 words → stop
        if current_words + sent_words > max_words:
            break

        final_sentences.append(sent)
        current_words += sent_words

    # Ensure final ends with punctuation
    paragraph = " ".join(final_sentences).strip()
    if not paragraph.endswith(('.', '!', '?')):
        # last sentence already ends correctly in TinyStories, but fallback safeguard:
        paragraph += "."

    return paragraph, idx

# Generate file
output_filename = "output.txt"

with open(output_filename, "w", encoding="utf-8") as f:
    current_index = 0

    for _ in range(300):
        paragraph, current_index = build_paragraph(current_index)

        formatted = f'"""\n{paragraph}\n""",\n\n'
        f.write(formatted)

print("File created:", output_filename)